<ion-header>
  <ion-toolbar class="shifts-toolbar">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Shift Management</ion-title>
    <ion-buttons slot="end" *ngIf="!authService.isTemp()">
      <ion-button (click)="addShift()" class="add-shift-main">
        <ion-icon name="add-circle-outline"></ion-icon>
        <span class="button-text">New Shift</span>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="shifts-content">
  <div class="calendar-container" *ngIf="!authService.isTemp()">
    <div class="calendar-header">
      <div class="header-content">
        <ion-button fill="clear" (click)="prev()" class="nav-button">
          <ion-icon class="navs" name="chevron-back-outline"></ion-icon>
        </ion-button>
        <h2 class="month-title">{{ viewDate | date:'MMMM yyyy' }}</h2>
        <ion-button fill="clear" (click)="next()" class="nav-button">
          <ion-icon class="navs" name="chevron-forward-outline"></ion-icon>
        </ion-button>
      </div>
    </div>

    <ng-template #customCellTemplate let-day="day" let-locale="locale">
      <div class="cal-cell-content">
        <div class="cal-cell-top">
          <span class="cal-day-number" [class.today]="day.isToday">
            {{ day.date | calendarDate:'monthViewDayNumber':locale }}
          </span>
        </div>
        <div class="cal-events" [class.has-events]="day.events?.length > 0">
          <div *ngFor="let event of day.events" class="cal-event" [style.backgroundColor]="event.color?.primary">
            <ion-icon name="time-outline"></ion-icon>
            <span class="event-title">{{ event.title }}</span>
          </div>
        </div>
        <div class="add-shift-overlay" *ngIf="!isPastDate(day.date) || day.isToday">
          <ion-button (click)="addShift(day.date)" class="add-shift-button" fill="clear" size="small">
            <ion-icon name="add-circle-outline"></ion-icon>
            <span class="button-text">Add</span>
          </ion-button>
        </div>
      </div>
    </ng-template>

    <div class="calendar-wrapper">
      <mwl-calendar-month-view
        [viewDate]="viewDate"
        [events]="events"
        [cellTemplate]="customCellTemplate"
        [refresh]="refresh"
        [activeDayIsOpen]="true">
      </mwl-calendar-month-view>
    </div>
  </div>

    <div class="shifts-container">
      <div class="shifts-grid">
        <div class="shift-card-wrapper" *ngFor="let shift of shifts">
          <ion-card class="shift-card" [class.active]="shift.status === 'started'">
            <div class="status-indicator" [class.pending]="shift.status === 'pending'"
                [class.started]="shift.status === 'started'"
                [class.completed]="shift.status === 'completed'"
                [class.checked-in]="shift.status === 'checked-in'">
              <ion-icon [name]="getStatusIcon(shift.status)"></ion-icon>
            </div>
            
            <ion-card-header>
              <div class="card-header-content">
                <ion-card-title>{{ shift.job.title }}</ion-card-title>
                <ion-card-subtitle>
                  <ion-icon name="business-outline"></ion-icon>
                  {{ shift.client.name }}
                </ion-card-subtitle>
              </div>
            </ion-card-header>

            <ion-card-content>
              <div class="shift-details">
                <div class="time-section">
                  <div class="time-item">
                    <ion-icon name="time-outline"></ion-icon>
                    <div class="time-info">
                      <span class="label">Start</span>
                      <span class="value">{{ shift.startTime | date:'MMM d, y h:mm a' }}</span>
                    </div>
                  </div>
                  <div class="time-separator"></div>
                  <div class="time-item">
                    <ion-icon name="time-outline"></ion-icon>
                    <div class="time-info">
                      <span class="label">End</span>
                      <span class="value">{{ shift.endTime | date:'MMM d, y h:mm a' }}</span>
                    </div>
                  </div>
                </div>

                <div class="temps-section" *ngIf="shift?.temps && shift.temps.length > 0">
                  <h4 class="section-title">
                    <ion-icon name="people-outline"></ion-icon>
                    Assigned Workers
                  </h4>
                  <div class="temps-grid">
                    <div class="temp-item" *ngFor="let temp of shift.temps">
                      <div class="temp-avatar">
                        <ion-icon name="person-circle-outline"></ion-icon>
                      </div>
                      <div class="temp-info">
                        <span class="temp-name">{{ temp.firstName }} {{ temp.lastName }}</span>
                        <span class="temp-status" [class]="temp.status">{{ temp.status }}</span>
                        <span [class.pending]="shift.status === 'pending'"
                          [class.started]="shift.status === 'started'"
                          [class.completed]="shift.status === 'completed'"
                          [class.checked-in]="shift.status === 'checked-in'">{{ shift.status }}</span>

                          <span [class.pending]="shift.tempStatus === 'pending'"
                          [class.pending]="shift.tempStatus === 'declined'"
                          [class.checked-in]="shift.tempStatus === 'accepted'"><span *ngIf="!authService.isTemp()">✔️ Temp's Response To The Shift </span> <span *ngIf="authService.isTemp()">✔️ My Response To The Shift </span> : {{ shift.tempStatus }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </ion-card-content>

            <div class="card-actions">
              <ion-button *ngIf="!authService.isTemp()" fill="clear" (click)="updateStatus(shift)" class="action-button">
                <ion-icon slot="start" name="sync-outline"></ion-icon>
                Update Status
              </ion-button>
              <!-- <ion-button fill="clear" (click)="viewShift(shift.id)" class="action-button primary">
                <ion-icon slot="start" name="eye-outline"></ion-icon>
                View Details
              </ion-button> -->
            </div>

             <div class="card-actions">
              <ion-button *ngIf="authService.isTemp() && (shift.tempStatus === 'pending' || !shift.tempStatus)" fill="clear" (click)="updateTStatus(shift)" class="action-button">
                <ion-icon slot="start" name="sync-outline"></ion-icon>
                Shift Response
              </ion-button>
              <!-- <ion-button fill="clear" (click)="viewShift(shift.id)" class="action-button primary">
                <ion-icon slot="start" name="eye-outline"></ion-icon>
                View Details
              </ion-button> -->
            </div>
          </ion-card>
        </div>
      </div>
    </div>
</ion-content>
