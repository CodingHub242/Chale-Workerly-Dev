<ion-header>
  <ion-toolbar class="form-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/shifts" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>
      <div class="title-content">
        <span>{{ isEditMode ? 'Edit' : 'New' }} Shift</span>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="form-content">
  <div class="page-header">
    <div class="header-content">
      <h1 class="main-title">{{ isEditMode ? 'Edit Shift Details' : 'Create New Shift' }}</h1>
      <p class="subtitle">Fill in the information below to {{ isEditMode ? 'update the' : 'create a new' }} shift</p>
    </div>
  </div>

  <div class="form-container">
    <div class="form-wrapper">
      <form [formGroup]="form" (ngSubmit)="saveShift()">
        <div class="form-card">
          <div class="card-header">
            <div class="header-icon">
              <ion-icon name="briefcase-outline"></ion-icon>
            </div>
            <div class="header-text">
              <h2>Job Details</h2>
              <p>Select job</p>
            </div>
          </div>
        
        <div class="card-content">
          <div class="form-group">
            <label class="form-label">Select Client</label>
            <div class="select-wrapper">
              <ion-select formControlName="clientId" interface="popover" placeholder="Choose a client" class="modern-select">
                <ion-select-option *ngFor="let client of clients" [value]="client.id">{{ client.name }}</ion-select-option>
              </ion-select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Select Job</label>
            <div class="select-wrapper">
              <ion-select formControlName="jobId" interface="popover" placeholder="Choose a job" class="modern-select">
                <ion-select-option *ngFor="let job of filteredJobs" [value]="job.id">{{ job.title }}</ion-select-option>
              </ion-select>
            </div>
          </div>

          <div class="form-group">
            <div class="assign-workers" (click)="openAssignDrawer()" [class.disabled]="!form.get('jobId')?.value">
              <div class="assign-content">
               
                <div class="assign-text">
                  <h3>Assign Workers</h3>
                  <p style="cursor: pointer;">Select workers for this shift</p>
                </div>
              </div>
              <div class="workers-count">
                <span class="count">{{ form.get('tempIds')?.value?.length || 0 }}</span>
                <span class="label"> Worker(s)</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-card">
        <div class="card-header">
          <h2>Schedule</h2>
        </div>
        
        <div class="card-content">
          <div class="schedule-toggle">
            <div class="toggle-label">
              <span>All Day Shift</span>
              <small>Enable for full day shifts</small>
            </div>
            <ion-toggle formControlName="allDay" mode="ios" class="modern-toggle"></ion-toggle>
          </div>

          <div class="time-inputs" *ngIf="!form.get('allDay')?.value">
            <div class="form-group">
              <label class="form-label">
                <ion-icon name="calendar-outline"></ion-icon>
                Start Time
              </label>
              <div class="datetime-wrapper">
                <ion-icon name="time-outline"></ion-icon>
                <ion-datetime-button datetime="startTime"></ion-datetime-button>
                <ion-modal [keepContentsMounted]="true">
                  <ng-template>
                    <ion-datetime 
                      id="startTime"
                      formControlName="startTime"
                      presentation="date-time"
                      preferWheel="true"
                      [showDefaultButtons]="true">
                    </ion-datetime>
                  </ng-template>
                </ion-modal>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <ion-icon name="calendar-outline"></ion-icon>
                End Time
              </label>
              <div class="datetime-wrapper">
                <ion-icon name="time-outline"></ion-icon>
                <ion-datetime-button datetime="endTime"></ion-datetime-button>
                <ion-modal [keepContentsMounted]="true">
                  <ng-template>
                    <ion-datetime 
                      id="endTime"
                      formControlName="endTime"
                      presentation="date-time"
                      preferWheel="true"
                      [showDefaultButtons]="true">
                    </ion-datetime>
                  </ng-template>
                </ion-modal>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-card">
        <div class="card-header">
          <ion-icon name="document-text-outline"></ion-icon>
          <h2>Additional Details</h2>
        </div>
        
        <div class="card-content">
          <div class="form-group">
            <label class="form-label">Notes</label>
            <div class="textarea-wrapper">
              <ion-textarea 
                formControlName="notes" 
                placeholder="Add any important details or instructions for this shift..."
                rows="4"
                class="modern-textarea"
                autoGrow="true">
              </ion-textarea>
            </div>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <ion-button 
          type="button" 
          fill="outline" 
          class="cancel-button"
          routerLink="/shifts">
          <ion-icon name="close-outline" slot="start"></ion-icon>
          Cancel
        </ion-button>

        <ion-button
          type="submit"
          class="submit-button"
          [disabled]="form.invalid || isLoading">
          <ion-spinner *ngIf="isLoading" name="crescent" slot="start"></ion-spinner>
          <ion-icon *ngIf="!isLoading" name="{{ isEditMode ? 'save' : 'add-circle' }}-outline" slot="start"></ion-icon>
          {{ isLoading ? 'Processing...' : (isEditMode ? 'Save Changes' : 'Create Shift') }}
        </ion-button>
      </div>
    </form>
  </div>
  </div>
</ion-content>
