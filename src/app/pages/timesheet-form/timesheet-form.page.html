<ion-header>
  <ion-toolbar class="form-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/timesheets"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <div class="title-content">
        <span>{{ isEditMode ? 'Edit' : 'Submit' }} Timesheet</span>
      </div>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="form-content">
  <form [formGroup]="timesheetForm" (ngSubmit)="onSubmit()">
    <ion-grid class="form-grid">
      <ion-row>
        <ion-col size="12">
          <ion-card class="form-card">
            <ion-card-header>
              <ion-card-title>Timesheet Information</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <!-- Temp Selection (only for admins) -->
              <ion-item *ngIf="authService.isAdmin() && temps.length > 0">
                <ion-label position="stacked">Select Temporary Worker</ion-label>
                <ion-select [value]="selectedTempId" (ionChange)="onTempChange($event)" placeholder="Choose a temp worker">
                  <ion-select-option *ngFor="let temp of temps" [value]="temp.id">
                    {{ temp.firstName }} {{ temp.lastName }}
                  </ion-select-option>
                </ion-select>
              </ion-item>
              
              <!-- Display current temp name for temp users -->
              <ion-item *ngIf="authService.isTemp()">
                <ion-label>
                  <h3>Worker: {{ currentUser?.firstName }} {{ currentUser?.lastName }}</h3>
                </ion-label>
              </ion-item>
              
              <div formGroupName="period">
                <ion-item>
                  <ion-label position="stacked">Start Date</ion-label>
                  <ion-datetime formControlName="startDate" presentation="date"></ion-datetime>
                </ion-item>
                
                <ion-item>
                  <ion-label position="stacked">End Date</ion-label>
                  <ion-datetime formControlName="endDate" presentation="date"></ion-datetime>
                </ion-item>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="12">
          <ion-card class="form-card">
            <ion-card-header>
              <ion-card-title class="card-title">
                <span>Work Entries</span>
                <ion-button fill="clear" (click)="addEntry()" size="small">
                  <ion-icon name="add-circle" slot="icon-only"></ion-icon>
                </ion-button>
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div formArrayName="entries">
                <div *ngFor="let entry of entries.controls; let i = index" [formGroupName]="i" class="entry-item">
                  <ion-item>
                    <ion-label position="stacked">Date</ion-label>
                    <ion-datetime formControlName="date" presentation="date"></ion-datetime>
                  </ion-item>
                  
                  <ion-item>
                    <ion-label position="stacked">Start Time</ion-label>
                    <ion-input formControlName="startTime" type="time"></ion-input>
                  </ion-item>
                  
                  <ion-item>
                    <ion-label position="stacked">End Time</ion-label>
                    <ion-input formControlName="endTime" type="time"></ion-input>
                  </ion-item>
                  
                  <ion-item>
                    <ion-label position="stacked">Break Duration (minutes)</ion-label>
                    <ion-input formControlName="breakDuration" type="number"></ion-input>
                  </ion-item>
                  
                  <ion-item>
                    <ion-label position="stacked">Notes</ion-label>
                    <ion-textarea formControlName="notes" rows="3"></ion-textarea>
                  </ion-item>
                  
                  <ion-button fill="clear" color="danger" (click)="removeEntry(i)" size="small">
                    <ion-icon name="trash" slot="icon-only"></ion-icon>
                    Remove Entry
                  </ion-button>
                </div>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="12">
          <ion-card class="form-card">
            <ion-card-header>
              <ion-card-title>Summary</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-item>
                <ion-label>Total Hours:</ion-label>
                <ion-label>{{ timesheetForm.get('totalHours')?.value | number:'1.2-2' }}</ion-label>
              </ion-item>
              
              <ion-item>
                <ion-label>Total Pay:</ion-label>
                <ion-label>{{ timesheetForm.get('totalPay')?.value | currency }}</ion-label>
              </ion-item>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col size="12">
          <div class="form-actions">
            <ion-button expand="block" type="submit" class="cancel-button">
              Save Draft
            </ion-button>
            
            <ion-button expand="block" (click)="submitForApproval()" class="submit-button">
              Submit for Approval
            </ion-button>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </form>
</ion-content>
